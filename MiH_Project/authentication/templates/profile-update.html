<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="UTF-8">
    <title>Edit Profile | Myanmar Innovations Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>

    <!-- Link CSS -->
    <link rel="stylesheet" href="{% static 'profile-edit-style.css' %}">

</head>
<body data-update-success="{% if messages %}{% for message in messages %}{% if message.tags == 'success' %}true{% endif %}{% endfor %}{% endif %}">
<!-- HEADER -->
<header class="navbar" style="background-color: #E4F8FF; z-index: 1000;">
    <div class="logo">
        <img src="{% static 'MiH Logo.jpg' %}" alt="Myanmar InnoHub Logo" class="logo-img">
        <span><b>Myanmar<br>InnoHub</b></span>
    </div>

    <nav>
        <a href="{% url 'test_homepage' %}"><b>Projects</b></a>
        <a href="{% url 'test_homepage' %}"><b>About</b></a>
        <a href="{% url 'test_homepage' %}"><b>Contact</b></a>
    </nav>

    <div class="nav-right">
        <button class="nav-btn">+ New Project</button>
        <button class="btn btn-light"><i class="bi bi-bell-fill me-1"></i></button>
    </div>
</header>

<div class="edit-wrapper">
    <form action="{% url 'update_profile' id=user.id %}"
          method="post"
          enctype="multipart/form-data">

        {% csrf_token %}

        {% if user.profile_pic %}
        <img src="{{ user.profile_pic.url}}"
             class="profile-img"
             alt="Profile Picture">
        {% else %}
        <img src="{% static 'assets/default-profile.png' %}"
             class="profile-img"
             alt="Default Profile">
        {% endif %}

        <!-- Upload new image -->
        <div class="mb-3 text-center">
            <input type="file"
                   name="profile_pic"
                   class="form-control w-50 mx-auto">
        </div>

        <div class="edite-group">
            <label>Name</label>
            <div class="name-box">
                <input type="text"
                       name="name"
                       value="{{ user.name }}"></div>

            <label>Email</label>
            <div class="email-box">
                <input type="email"
                       name="email"
                       disabled
                       value="{{ user.email }}">
            </div>

            <label>Phone Number</label>
            <div class="phone-box">
                <input type="text"
                       name="phone"
                       value="{{ form.phone.value|default:user.phone }}"
                       class="form-control"
                       inputmode="numeric">
                <span class="text-danger">
                    {{ form.phone.errors }}
                </span>
            </div>

            <label>Address</label>
            <div class="address-box">
                <input type="text"
                       name="address"
                       value="{{ user.address }}"></div>

            <div class="buttons">
                <button type="submit" class="btn btn-change">
                    Update
                </button>
                <button type="button"
                        class="btn btn-cancel"
                        id="cancelBtn">
                    Cancel
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Success Modal -->
<div id="successModal" class="modal">
    <div class="modal-content">
        <img src="{% static 'assets/success-icon.png'%}" class="modal-icon" alt="success">
        <h3 class="modal-title">Success!</h3>
        <p class="modal-text">Your profile is successfully updated.</p>
        <button id="modalBackBtn">Back</button>
    </div>
</div>

<script>
    const modal = document.getElementById("successModal");
    const modalBackBtn = document.getElementById("modalBackBtn");

    // Check if success flag is set
    const isSuccess = document.body.dataset.updateSuccess === "true";
    if (isSuccess) {
        modal.style.display = "flex";
    }

    modalBackBtn.addEventListener("click", function () {
        window.location.href = "{% url 'profile_page' %}";
    });

    // Close modal when clicking outside
    window.addEventListener("click", function (event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    });

    // Cancel button goes back
    const cancelBtn = document.getElementById("cancelBtn");
    cancelBtn.addEventListener("click", function () {
        window.location.href = "{% url 'profile_page' %}";
    });
</script>
</body>
</html>