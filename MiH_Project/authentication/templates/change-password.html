<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="UTF-8">
    <title>Change Password | Myanmar Innovations Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>

    <!-- Link CSS -->
    <link rel="stylesheet" href="{% static 'pw-style.css' %}">

</head>
<body data-update-success="{% if messages %}{% for message in messages %}{% if message.tags == 'success' %}true{% endif %}{% endfor %}{% endif %}">
<!-- HEADER -->
<header class="navbar fixed-top" style="background-color: #E4F8FF; z-index: 1000;">
    <div class="logo">
        <img src="{% static 'MiH Logo.jpg' %}" alt="Myanmar InnoHub Logo" class="logo-img">
        <span><b>Myanmar<br>InnoHub</b></span>
    </div>

    <nav>
        <a href="{% url 'test_homepage' %}"><b>Projects</b></a>
        <a href="{% url 'test_homepage' %}"><b>About</b></a>
        <a href="{% url 'test_homepage' %}"><b>Contact</b></a>
    </nav>

    <div class="nav-right">
        <button class="nav-btn">+ New Project</button>
        <button class="btn btn-light"><i class="bi bi-bell-fill me-1"></i></button>
    </div>
</header>


<div class="container">
    <h2>Change Password</h2>
    <p class="subtitle">
        Enter and confirm your new password to regain access
    </p>

    <form method="POST" action="{% url 'change_password' %}">
        {% csrf_token %}
        <div class="form-group">
            <label>Old Password</label>
            <div class="password-box">
                <input type="password" class="form-control {% if form.old_password.errors %}is-invalid{% endif %}"
                       name="old_password" placeholder="Enter old password">
                <div class="invalid-feedback">
                    {% for error in form.old_password.errors %}
                    {{ error }}
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="form-group">
            <label>New Password</label>
            <div class="password-box">
                <input type="password" class="form-control {% if form.new_password.errors %}is-invalid{% endif %}"
                       name="new_password" placeholder="Enter new password">
                <div class="invalid-feedback">
                    {% for error in form.new_password.errors %}
                    {{ error }}
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="form-group">
            <label>Confirm Password</label>
            <div class="password-box">
                <input type="password"
                       class="form-control {% if form.confirm_password.errors %}is-invalid{% endif %}"
                       name="confirm_password" placeholder="Confirm new password">
                <div class="invalid-feedback">
                    {% for error in form.confirm_password.errors %}
                    {{ error }}
                    {% endfor %}
                </div>
            </div>
        </div>
        
        {% if messages %}
        {% for message in messages %}
        <div class="alert
        {% if message.tags == 'error' %}alert-danger
        {% elif message.tags == 'success' %}alert-success
        {% else %}alert-info{% endif %}"
             role="alert">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}

        <div class="d-flex justify-content-center gap-2 mt-4">
            <button type="submit" class="btn btn-primary">Change</button>
            <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
        </div>
    </form>

    <!-- Popup Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <img src="{% static 'assets/success-icon.png' %}" alt="Success Icon" class="modal-icon">
            <h3 class="modal-title">Success!</h3>
            <p class="modal-text">Your password is successfully changed.</p>
            <button id="modalBackBtn" class="btn btn-primary">Back</button>
        </div>
    </div>
</div>

<script>
    const modal = document.getElementById("successModal");
    const modalBackBtn = document.getElementById("modalBackBtn");

    // Check if success flag is set
    const isSuccess = document.body.dataset.updateSuccess === "true";
    if (isSuccess) {
        modal.style.display = "flex";
    }

    modalBackBtn.addEventListener("click", function () {
        window.location.href = "{% url 'profile_page' %}";
    });

    // Close modal when clicking outside
    window.addEventListener("click", function (event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    });

    // Cancel button goes back
    const cancelBtn = document.getElementById("cancelBtn");
    cancelBtn.addEventListener("click", function () {
        window.location.href = "{% url 'profile_page' %}";
    });
</script>

</body>
</html>
